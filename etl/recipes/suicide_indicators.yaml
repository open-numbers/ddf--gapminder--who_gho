# Recipe to create suicide indicators by age group and sex from WHO GHO data
info:
  id: suicide_indicators
  base:
    - &d1 open-numbers/ddf--who--gho

ingredients:
  - id: suicide-datapoints
    dataset: *d1
    key: "country, year, agegroup, sex"
    value:
      - sdgsuicide

cooking:
  datapoints:
    - procedure: translate_header
      ingredients:
        - suicide-datapoints
      options:
        dictionary:
          country: geo
          year: time
      result: suicide-datapoints-headers-translated
    - procedure: flatten
      ingredients:
        - suicide-datapoints-headers-translated
      options:
        flatten_dimensions:
          - agegroup
          - sex
        dictionary:
          sdgsuicide: "suicide_{sex}_{agegroup}_per_100000_people"
      result: suicide-datapoints-flattened
    - procedure: filter
      ingredients:
        - suicide-datapoints-flattened
      options:
        item:
          # All ages, by sex
          - suicide_sex_btsx_agegroup_yearsall_per_100000_people
          - suicide_sex_mle_agegroup_yearsall_per_100000_people
          - suicide_sex_fmle_agegroup_yearsall_per_100000_people
          # Age group 15-19, both sexes
          - suicide_sex_btsx_agegroup_years15_19_per_100000_people
          # Age group 15-24, both sexes
          - suicide_sex_btsx_agegroup_years15_24_per_100000_people
          # Age group 15-29, both sexes
          - suicide_sex_btsx_agegroup_years15_29_per_100000_people
          # Age group 25-34, both sexes
          - suicide_sex_btsx_agegroup_years25_34_per_100000_people
          # Age group 30-49, both sexes
          - suicide_sex_btsx_agegroup_years30_49_per_100000_people
          # Age group 35-44, both sexes
          - suicide_sex_btsx_agegroup_years35_44_per_100000_people
          # Age group 45-54, both sexes
          - suicide_sex_btsx_agegroup_years45_54_per_100000_people
          # Age group 55-64, both sexes
          - suicide_sex_btsx_agegroup_years55_64_per_100000_people
          # Age group 65-74, both sexes
          - suicide_sex_btsx_agegroup_years65_74_per_100000_people
          # Age group 75-84, both sexes
          - suicide_sex_btsx_agegroup_years75_84_per_100000_people
          # Age group 85+, both sexes
          - suicide_sex_btsx_agegroup_years85plus_per_100000_people
      result: suicide-datapoints-filtered
    - procedure: translate_header
      ingredients:
        - suicide-datapoints-filtered
      options:
        dictionary:
          # All ages, by sex
          suicide_sex_btsx_agegroup_yearsall_per_100000_people: suicide_per_100000_people
          suicide_sex_mle_agegroup_yearsall_per_100000_people: suicide_men_per_100000_people
          suicide_sex_fmle_agegroup_yearsall_per_100000_people: suicide_women_per_100000_people
          # Age group 15-19, both sexes
          suicide_sex_btsx_agegroup_years15_19_per_100000_people: suicide_age_15_19_per_100000_people
          # Age group 15-24, both sexes
          suicide_sex_btsx_agegroup_years15_24_per_100000_people: suicide_age_15_24_per_100000_people
          # Age group 15-29, both sexes
          suicide_sex_btsx_agegroup_years15_29_per_100000_people: suicide_age_15_29_per_100000_people
          # Age group 25-34, both sexes
          suicide_sex_btsx_agegroup_years25_34_per_100000_people: suicide_age_25_34_per_100000_people
          # Age group 30-49, both sexes
          suicide_sex_btsx_agegroup_years30_49_per_100000_people: suicide_age_30_49_per_100000_people
          # Age group 35-44, both sexes
          suicide_sex_btsx_agegroup_years35_44_per_100000_people: suicide_age_35_44_per_100000_people
          # Age group 45-54, both sexes
          suicide_sex_btsx_agegroup_years45_54_per_100000_people: suicide_age_45_54_per_100000_people
          # Age group 55-64, both sexes
          suicide_sex_btsx_agegroup_years55_64_per_100000_people: suicide_age_55_64_per_100000_people
          # Age group 65-74, both sexes
          suicide_sex_btsx_agegroup_years65_74_per_100000_people: suicide_age_65_74_per_100000_people
          # Age group 75-84, both sexes
          suicide_sex_btsx_agegroup_years75_84_per_100000_people: suicide_age_75_84_per_100000_people
          # Age group 85+, both sexes
          suicide_sex_btsx_agegroup_years85plus_per_100000_people: suicide_age_85plus_per_100000_people
      result: suicide-datapoints-final
